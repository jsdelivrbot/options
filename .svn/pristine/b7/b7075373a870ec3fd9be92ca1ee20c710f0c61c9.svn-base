import { Component } from '@angular/core';
import { NavController, NavParams,AlertController,LoadingController } from 'ionic-angular';
import {FormBuilder, Validators} from '@angular/forms';
import { myService } from "../../myService";
import { GlobalData } from "../../../../providers/GlobalData";
import {TradeService} from '../../../trade/tradeService';
import {SiDrawpasswordPage} from '../../self-info/si-drawpassword/si-drawpassword';
@Component({
	selector: 'page-si-pay',
	templateUrl: 'si-pay.html',
})
export class SiPayPage {
	  //屏幕分辨比
      passwordForm: any;
      private subData:any=[];
      constructor(
          private navCtrl: NavController,
          private navParams: NavParams,
          private formBuilder: FormBuilder,
          private myService:myService,
          private globalData:GlobalData,
          private tradeService: TradeService,
          private alertCtrl: AlertController
          ) {
            this.subData=navParams.get('data');
          this.passwordForm = this.formBuilder.group({
                 drawpassword: ['', [Validators.required,Validators.minLength(6),Validators.maxLength(6),Validators.pattern("[0-9]*")]]
          });
      }
  
      ionViewWillEnter() {
          if(!this.globalData.isMentionPassword){
            this.alertCtrl.create({
				title: '请先设置支付密码',
				buttons: [
				  {
					text: '取消',
					role: 'cancel',
					handler: () => {
					}
				  },
				  {
					text: '设置',
					handler: () => {
						this.navCtrl.push(SiDrawpasswordPage)
					}
				  }
				]
			  }).present();
			return;
		}
      }
      //支付
      resetPassword(val){
          this.subData.mentionPassword=val.drawpassword;
          this.tradeService.subscription(this.subData)
          .subscribe(res => {
              if(res.success=='true'){
                  this.alertCtrl.create({
                      title: '申购成功',
                      subTitle: '',
                      buttons: [{
                          text: '确定',
                          handler: () => {
                              this.navCtrl.pop();
                          }
                      }]
                      }).present();
              }else{
                  this.alertCtrl.create({
                      title: res.errorMsg,
                      subTitle: '',
                      buttons: [{text: '确定'}]
                      }).present();
              }
          });
      }
}
